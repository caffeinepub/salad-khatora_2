{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 29,
  "summary": "Salad Khatora app — Phase 4 (Customer & Subscriptions: Loyalty Points, Delivery Calendar, Order History) deployed. Now building Phase 5 Admin & Usability features: Role-based staff accounts (cashier, manager, admin), Activity/audit log (track who made changes and when), and Dark mode toggle.",
  "architectural_notes": [
    "White and green UI theme, fully mobile-friendly",
    "App is named Salad Khatora",
    "Sales & Revenue features (Discounts, Reports, Tax Config) are grouped under a Sales dropdown in the navigation"
  ],
  "known_issues": [
    "Admin access is tied to Internet Identity principal; users may lose access if they switch login methods or devices",
    "Admin access page shows 'no admin access' error without offering the 'Claim Admin' option when admin role is vacant",
    "Staff account creation modal freezes/gets stuck after entering the name field"
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-build-an-admin-login-screen-on-the-frontend-with-email-and-password-fields-and-a-login-button-show-error-messages-for-invalid-credentials-on-successful-login-redirect-to-the-dashboard",
      "title": "Build an admin login screen on the frontend with email and password fields and a Login button. Show error messages for invalid credentials. On successful login, redirect to the dashboard.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-build-an-inventory-management-page-on-the-frontend-displaying-all-ingredients-in-a-table-or-card-list-with-columns-for-name-quantity-unit-cost-price-supplier-low-stock-threshold-and-total-value-include-an-add-ingredient-form-modal-with-all-required-fields-support-editing-and-deleting-existing-ingredients-visually-highlight-rows-where-current-quantity-is-at-or-below-the-low-stock-threshold",
      "title": "Build an Inventory Management page on the frontend displaying all ingredients in a table or card list with columns for name, quantity, unit, cost price, supplier, low-stock threshold, and total value. Include an Add Ingredient form/modal with all required fields. Support editing and deleting existing ingredients. Visually highlight rows where current quantity is at or below the low-stock threshold.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-dashboard-page-as-the-default-post-login-view-display-key-stat-cards-for-total-number-of-ingredients-total-inventory-value-sum-of-all-total-values-and-count-of-low-stock-items-show-a-low-stock-alerts-section-listing-all-ingredients-at-or-below-their-low-stock-threshold-with-name-current-quantity-unit-and-threshold-stats-must-reflect-current-backend-data",
      "title": "Build a Dashboard page as the default post-login view. Display key stat cards for: total number of ingredients, total inventory value (sum of all total values), and count of low-stock items. Show a low-stock alerts section listing all ingredients at or below their low-stock threshold with name, current quantity, unit, and threshold. Stats must reflect current backend data.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-apply-a-consistent-white-and-green-visual-theme-across-all-pages-include-a-sidebar-or-top-navigation-for-routing-between-dashboard-and-inventory-pages-ensure-the-entire-app-is-fully-responsive-and-mobile-friendly-with-readable-typography-and-accessible-touch-targets-render-the-generated-logo-frontend-public-assets-generated-logo-png-in-the-navigation-header",
      "title": "Apply a consistent white and green visual theme across all pages. Include a sidebar or top navigation for routing between Dashboard and Inventory pages. Ensure the entire app is fully responsive and mobile-friendly with readable typography and accessible touch targets. Render the generated logo (frontend/public/assets/generated/logo.png) in the navigation header.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-add-react-query-hooks-in-usequeries-ts-for-all-new-backend-operations-usemenuitems-usemenuitem-usecreatemenuitem-useupdatemenuitem-usedeletemenuitem-usetogglemenuitemavailability-usesaleorders-usesaleorder-usecreatesaleorder-and-usesalesstats",
      "title": "Add React Query hooks in useQueries.ts for all new backend operations: useMenuItems, useMenuItem, useCreateMenuItem, useUpdateMenuItem, useDeleteMenuItem, useToggleMenuItemAvailability, useSaleOrders, useSaleOrder, useCreateSaleOrder, and useSalesStats.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-menu-management-page-accessible-at-menu-display-all-menu-items-in-a-card-or-table-layout-showing-name-description-selling-price-ingredient-count-and-availability-status-active-inactive-badge-include-an-add-menu-item-form-modal-with-fields-name-description-selling-price-availability-toggle-and-an-ingredient-selector-choose-from-existing-inventory-ingredients-with-quantity-per-serving-support-editing-and-deleting-existing-menu-items-allow-toggling-availability-inline-add-a-menu-navigation-link-in-the-layout-sidebar-header",
      "title": "Build a Menu Management page accessible at /menu. Display all menu items in a card or table layout showing name, description, selling price, ingredient count, and availability status (active/inactive badge). Include an Add Menu Item form/modal with fields: name, description, selling price, availability toggle, and an ingredient selector (choose from existing inventory ingredients with quantity per serving). Support editing and deleting existing menu items. Allow toggling availability inline. Add a 'Menu' navigation link in the Layout sidebar/header.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-billing-sales-page-accessible-at-sales-the-page-has-two-sections-1-new-order-a-point-of-sale-style-form-to-select-menu-items-only-available-ones-set-quantities-display-a-live-calculated-total-add-an-optional-note-and-submit-to-create-a-sale-order-2-sales-history-a-table-listing-all-past-orders-with-columns-for-order-id-date-time-items-summary-and-total-amount-each-row-should-be-expandable-or-linkable-to-show-full-order-details-add-a-sales-navigation-link-in-the-layout-sidebar-header",
      "title": "Build a Billing & Sales page accessible at /sales. The page has two sections: (1) New Order — a point-of-sale style form to select menu items (only available ones), set quantities, display a live-calculated total, add an optional note, and submit to create a sale order; (2) Sales History — a table listing all past orders with columns for order ID, date/time, items summary, and total amount. Each row should be expandable or linkable to show full order details. Add a 'Sales' navigation link in the Layout sidebar/header.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-dashboard-page-to-include-two-additional-stat-cards-sourced-from-getdashboardsalesstats-total-revenue-all-time-and-orders-today-these-cards-should-appear-alongside-the-existing-inventory-stat-cards-and-follow-the-same-visual-style",
      "title": "Update the Dashboard page to include two additional stat cards sourced from getDashboardSalesStats: 'Total Revenue' (all-time) and 'Orders Today'. These cards should appear alongside the existing inventory stat cards and follow the same visual style.",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-add-react-query-hooks-in-usequeries-ts-for-all-new-backend-operations-usecustomers-usecustomer-usecreatecustomer-useupdatecustomer-usedeletecustomer-usesubscriptions-usesubscription-usecreatesubscription-useupdatesubscription-usecancelsubscription-usepausesubscription-useresumesubscription-usealerts-usemarkalertread-usemarkallalertsread",
      "title": "Add React Query hooks in useQueries.ts for all new backend operations: useCustomers, useCustomer, useCreateCustomer, useUpdateCustomer, useDeleteCustomer, useSubscriptions, useSubscription, useCreateSubscription, useUpdateSubscription, useCancelSubscription, usePauseSubscription, useResumeSubscription, useAlerts, useMarkAlertRead, useMarkAllAlertsRead.",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-customer-management-page-accessible-at-customers-display-all-customers-in-a-searchable-table-with-columns-for-name-email-phone-and-number-of-subscriptions-include-an-add-customer-modal-with-fields-name-email-phone-address-and-notes-support-editing-and-deleting-existing-customers-clicking-a-customer-row-opens-a-customer-detail-view-showing-their-full-profile-and-a-list-of-their-subscriptions-add-a-customers-navigation-link-in-the-layout-sidebar-header",
      "title": "Build a Customer Management page accessible at /customers. Display all customers in a searchable table with columns for name, email, phone, and number of subscriptions. Include an Add Customer modal with fields: name, email, phone, address, and notes. Support editing and deleting existing customers. Clicking a customer row opens a Customer Detail view showing their full profile and a list of their subscriptions. Add a 'Customers' navigation link in the Layout sidebar/header.",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-subscription-management-page-accessible-at-subscriptions-display-all-subscriptions-in-a-table-with-columns-for-customer-name-plan-name-menu-items-frequency-next-renewal-date-total-price-and-status-badge-active-paused-cancelled-include-an-add-subscription-modal-with-fields-customer-selector-plan-name-menu-item-multi-selector-frequency-in-days-start-date-and-total-price-auto-calculated-from-selected-menu-items-support-pausing-resuming-and-cancelling-subscriptions-inline-add-a-subscriptions-navigation-link-in-the-layout-sidebar-header",
      "title": "Build a Subscription Management page accessible at /subscriptions. Display all subscriptions in a table with columns for customer name, plan name, menu items, frequency, next renewal date, total price, and status badge (active/paused/cancelled). Include an Add Subscription modal with fields: customer selector, plan name, menu item multi-selector, frequency in days, start date, and total price (auto-calculated from selected menu items). Support pausing, resuming, and cancelling subscriptions inline. Add a 'Subscriptions' navigation link in the Layout sidebar/header.",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-build-an-alerts-panel-accessible-at-alerts-display-all-alerts-in-a-list-sorted-newest-first-with-an-icon-and-badge-distinguishing-alert-types-low-stock-warning-icon-subscription-renewal-calendar-icon-other-info-icon-show-the-alert-message-related-entity-reference-and-timestamp-include-a-mark-all-as-read-button-allow-marking-individual-alerts-as-read-which-visually-dims-or-removes-them-show-an-unread-alert-count-badge-on-the-alerts-navigation-link-in-the-sidebar-header",
      "title": "Build an Alerts panel accessible at /alerts. Display all alerts in a list sorted newest-first with an icon and badge distinguishing alert types (low-stock: warning icon, subscription renewal: calendar icon, other: info icon). Show the alert message, related entity reference, and timestamp. Include a 'Mark all as read' button. Allow marking individual alerts as read, which visually dims or removes them. Show an unread alert count badge on the 'Alerts' navigation link in the sidebar/header.",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-add-react-query-hooks-in-usequeries-ts-for-all-new-backend-operations-usesuppliers-usesupplier-usecreatesupplier-useupdatesupplier-usedeletesupplier-usepurchaseorders-usepurchaseorder-usecreatepurchaseorder-useupdatepurchaseorderstatus-useautogeneratepurchaseorders-usewastelogs-usecreatewastelog-usewastestats",
      "title": "Add React Query hooks in useQueries.ts for all new backend operations: useSuppliers, useSupplier, useCreateSupplier, useUpdateSupplier, useDeleteSupplier, usePurchaseOrders, usePurchaseOrder, useCreatePurchaseOrder, useUpdatePurchaseOrderStatus, useAutoGeneratePurchaseOrders, useWasteLogs, useCreateWasteLog, useWasteStats.",
      "reqIds": [
        "REQ-26"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-supplier-management-page-accessible-at-suppliers-display-all-suppliers-in-a-searchable-table-with-columns-for-name-contact-person-email-phone-and-lead-time-days-include-an-add-supplier-modal-with-fields-name-contact-person-email-phone-address-lead-time-days-and-notes-support-editing-and-deleting-existing-suppliers-include-a-generate-purchase-orders-button-that-calls-autogeneratepurchaseorders-and-shows-a-success-error-toast-add-a-suppliers-navigation-link-in-the-layout-sidebar-header",
      "title": "Build a Supplier Management page accessible at /suppliers. Display all suppliers in a searchable table with columns for name, contact person, email, phone, and lead time (days). Include an Add Supplier modal with fields: name, contact person, email, phone, address, lead time (days), and notes. Support editing and deleting existing suppliers. Include a 'Generate Purchase Orders' button that calls autoGeneratePurchaseOrders and shows a success/error toast. Add a 'Suppliers' navigation link in the Layout sidebar/header.",
      "reqIds": [
        "REQ-27"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-purchase-orders-page-accessible-at-purchase-orders-display-all-purchase-orders-in-a-table-with-columns-for-order-id-supplier-name-items-count-status-badge-pending-received-cancelled-and-created-date-allow-updating-a-purchase-order-s-status-to-received-or-cancelled-inline-add-a-purchase-orders-navigation-link-under-the-suppliers-section-in-the-layout-sidebar-header",
      "title": "Build a Purchase Orders page accessible at /purchase-orders. Display all purchase orders in a table with columns for order ID, supplier name, items count, status badge (pending/received/cancelled), and created date. Allow updating a purchase order's status to 'received' or 'cancelled' inline. Add a 'Purchase Orders' navigation link under the Suppliers section in the Layout sidebar/header.",
      "reqIds": [
        "REQ-28"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-the-inventory-management-page-inventory-to-show-two-new-optional-columns-supplier-linked-supplier-name-if-set-and-expiry-date-formatted-date-if-set-highlighted-in-red-if-expiring-within-7-days-update-the-add-edit-ingredient-modals-to-include-a-supplier-selector-from-the-suppliers-list-and-an-expiry-date-picker",
      "title": "Extend the Inventory Management page (/inventory) to show two new optional columns: Supplier (linked supplier name, if set) and Expiry Date (formatted date, if set, highlighted in red if expiring within 7 days). Update the Add/Edit Ingredient modals to include a supplier selector (from the suppliers list) and an expiry date picker.",
      "reqIds": [
        "REQ-29"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-waste-spoilage-logging-page-accessible-at-waste-log-the-page-has-two-sections-1-log-waste-a-form-to-select-an-ingredient-enter-quantity-wasted-select-a-reason-spoiled-overcooked-dropped-other-and-submit-the-form-displays-the-estimated-cost-loss-before-submission-2-waste-history-a-table-listing-all-waste-logs-with-columns-for-ingredient-name-quantity-unit-reason-cost-loss-and-date-time-show-a-summary-card-at-the-top-with-total-cost-loss-and-total-log-count-sourced-from-getwastestats-add-a-waste-log-navigation-link-in-the-layout-sidebar-header",
      "title": "Build a Waste & Spoilage Logging page accessible at /waste-log. The page has two sections: (1) Log Waste — a form to select an ingredient, enter quantity wasted, select a reason (spoiled, overcooked, dropped, other), and submit; the form displays the estimated cost loss before submission. (2) Waste History — a table listing all waste logs with columns for ingredient name, quantity, unit, reason, cost loss, and date/time. Show a summary card at the top with total cost loss and total log count sourced from getWasteStats. Add a 'Waste Log' navigation link in the Layout sidebar/header.",
      "reqIds": [
        "REQ-30"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-the-alerts-panel-alerts-to-display-two-new-alert-types-expirywarning-calendar-with-exclamation-icon-orange-badge-for-ingredients-expiring-within-7-days-following-the-same-list-layout-and-mark-as-read-behaviour-as-existing-alert-types",
      "title": "Extend the Alerts panel (/alerts) to display two new alert types: #expiryWarning (calendar with exclamation icon, orange badge) for ingredients expiring within 7 days, following the same list layout and mark-as-read behaviour as existing alert types.",
      "reqIds": [
        "REQ-31"
      ],
      "version": 1
    },
    {
      "id": "feature-add-react-query-hooks-in-frontend-src-hooks-usequeries-ts-for-all-new-backend-operations-introduced-in-req-32-through-req-34-useprofitmargin-query-by-menuitemid-useavailablemenuitems-query-usecombos-query-usecombo-query-by-id-usecreatecombodeal-mutation-useupdatecombodeal-mutation-usedeletecombodeal-mutation-usetogglecombodealavailability-mutation-follow-the-same-patterns-as-existing-hooks-in-usequeries-ts-actor-based-calls-proper-query-keys-cache-invalidation-on-mutations",
      "title": "Add React Query hooks in `frontend/src/hooks/useQueries.ts` for all new backend operations introduced in REQ-32 through REQ-34: `useProfitMargin` (query by menuItemId), `useAvailableMenuItems` (query), `useCombos` (query), `useCombo` (query by id), `useCreateComboDeal` (mutation), `useUpdateComboDeal` (mutation), `useDeleteComboDeal` (mutation), `useToggleComboDealAvailability` (mutation). Follow the same patterns as existing hooks in useQueries.ts (actor-based calls, proper query keys, cache invalidation on mutations).",
      "reqIds": [
        "REQ-36"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-the-menu-management-page-menu-frontend-src-pages-menupage-tsx-to-display-a-recipe-costing-panel-per-menu-item-in-each-menu-item-card-or-detail-view-show-cost-per-serving-selling-price-gross-profit-and-profit-margin-sourced-from-useprofitmargin-use-a-green-colour-for-positive-margins-and-red-for-negative-margins-display-a-small-profit-margin-badge-on-each-card-in-the-card-grid",
      "title": "Extend the Menu Management page (`/menu`, `frontend/src/pages/MenuPage.tsx`) to display a recipe costing panel per menu item. In each menu item card or detail view, show: Cost per Serving, Selling Price, Gross Profit, and Profit Margin % (sourced from `useProfitMargin`). Use a green colour for positive margins and red for negative margins. Display a small profit margin badge on each card in the card grid.",
      "reqIds": [
        "REQ-37"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-the-add-edit-menu-item-modal-on-the-menu-management-page-menu-to-include-time-based-availability-fields-an-available-from-hour-picker-0-23-an-available-to-hour-picker-0-23-and-a-multi-select-day-picker-mon-sun-checkboxes-these-fields-are-optional-leaving-them-blank-means-the-item-is-always-available-when-isavailable-is-true-display-a-human-readable-availability-schedule-summary-e-g-mon-fri-09-00-17-00-on-each-menu-item-card-when-time-constraints-are-set",
      "title": "Extend the Add/Edit Menu Item modal on the Menu Management page (`/menu`) to include time-based availability fields: an 'Available From' hour picker (0–23), an 'Available To' hour picker (0–23), and a multi-select day picker (Mon–Sun checkboxes). These fields are optional — leaving them blank means the item is always available when `isAvailable` is true. Display a human-readable availability schedule summary (e.g. 'Mon–Fri, 09:00–17:00') on each menu item card when time constraints are set.",
      "reqIds": [
        "REQ-38"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-combo-deals-page-accessible-at-combos-display-all-combo-deals-in-a-card-or-table-layout-showing-combo-name-description-number-of-included-items-total-individual-price-bundle-price-savings-amount-and-availability-badge-active-inactive-include-an-add-combo-modal-with-fields-name-description-menu-item-multi-selector-choose-from-existing-menu-items-and-bundle-price-auto-display-total-individual-price-and-savings-as-the-user-selects-items-support-editing-and-deleting-existing-combos-allow-toggling-availability-inline-add-a-combos-navigation-link-in-the-layout-sidebar-header-under-the-menu-section",
      "title": "Build a Combo Deals page accessible at `/combos`. Display all combo deals in a card or table layout showing: combo name, description, number of included items, total individual price, bundle price, savings amount, and availability badge (active/inactive). Include an 'Add Combo' modal with fields: name, description, menu item multi-selector (choose from existing menu items), and bundle price (auto-display total individual price and savings as the user selects items). Support editing and deleting existing combos. Allow toggling availability inline. Add a 'Combos' navigation link in the Layout sidebar/header under the Menu section.",
      "reqIds": [
        "REQ-39"
      ],
      "version": 1
    },
    {
      "id": "feature-add-an-admin-settings-page-on-the-frontend-accessible-at-admin-settings-the-page-must-be-accessible-only-when-the-user-is-logged-in-display-the-current-admin-principal-include-a-reassign-admin-form-with-a-text-input-for-the-new-principal-id-and-a-submit-button-that-calls-reassignadmin-show-a-success-toast-on-completion-or-an-error-message-on-failure-include-a-vacate-admin-role-button-that-calls-vacateadmin-with-a-confirmation-dialog-before-proceeding-warn-the-user-that-vacating-the-role-will-lock-them-out-until-someone-claims-it-include-a-claim-admin-if-vacant-button-that-calls-claimadminifvacant-show-success-or-error-feedback-add-an-admin-settings-navigation-link-in-the-layout-sidebar-header-add-the-corresponding-react-query-hooks-useadminprincipal-query-usereassignadmin-mutation-usevacateadmin-mutation-and-useclaimadminifvacant-mutation-in-frontend-src-hooks-usequeries-ts-following-existing-hook-patterns",
      "title": "Add an Admin Settings page on the frontend accessible at `/admin-settings`. The page must be accessible only when the user is logged in. Display the current admin principal. Include a 'Reassign Admin' form with a text input for the new principal ID and a submit button that calls `reassignAdmin`; show a success toast on completion or an error message on failure. Include a 'Vacate Admin Role' button that calls `vacateAdmin` with a confirmation dialog before proceeding; warn the user that vacating the role will lock them out until someone claims it. Include a 'Claim Admin (if vacant)' button that calls `claimAdminIfVacant`; show success or error feedback. Add an 'Admin Settings' navigation link in the Layout sidebar/header. Add the corresponding React Query hooks `useAdminPrincipal` (query), `useReassignAdmin` (mutation), `useVacateAdmin` (mutation), and `useClaimAdminIfVacant` (mutation) in `frontend/src/hooks/useQueries.ts` following existing hook patterns.",
      "reqIds": [
        "REQ-41"
      ],
      "version": 1
    },
    {
      "id": "feature-add-react-query-hooks-in-frontend-src-hooks-usequeries-ts-for-all-new-backend-operations-introduced-in-req-42-through-req-45-usediscountcodes-query-usediscountcode-query-by-id-usecreatediscountcode-mutation-useupdatediscountcode-mutation-usedeletediscountcode-mutation-usetogglediscountcodeactive-mutation-useapplydiscountcode-mutation-usetaxconfigs-query-usetaxconfig-query-by-id-usecreatetaxconfig-mutation-useupdatetaxconfig-mutation-usedeletetaxconfig-mutation-usetoggletaxconfigactive-mutation-usecalculatetax-query-by-subtotal-usesalesreport-query-by-period-and-referencedate-follow-the-same-patterns-as-existing-hooks-actor-based-calls-proper-query-keys-cache-invalidation-on-mutations",
      "title": "Add React Query hooks in `frontend/src/hooks/useQueries.ts` for all new backend operations introduced in REQ-42 through REQ-45: `useDiscountCodes` (query), `useDiscountCode` (query by id), `useCreateDiscountCode` (mutation), `useUpdateDiscountCode` (mutation), `useDeleteDiscountCode` (mutation), `useToggleDiscountCodeActive` (mutation), `useApplyDiscountCode` (mutation), `useTaxConfigs` (query), `useTaxConfig` (query by id), `useCreateTaxConfig` (mutation), `useUpdateTaxConfig` (mutation), `useDeleteTaxConfig` (mutation), `useToggleTaxConfigActive` (mutation), `useCalculateTax` (query by subtotal), `useSalesReport` (query by period and referenceDate). Follow the same patterns as existing hooks (actor-based calls, proper query keys, cache invalidation on mutations).",
      "reqIds": [
        "REQ-46"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-discounts-coupons-page-accessible-at-discounts-display-all-discount-codes-in-a-table-with-columns-for-code-description-type-percentage-fixed-value-minimum-order-max-uses-used-count-expiry-date-and-status-badge-active-inactive-include-an-add-discount-code-modal-with-all-required-fields-code-description-discount-type-selector-percentage-or-fixed-discount-value-optional-minimum-order-amount-optional-max-uses-optional-expiry-date-and-active-toggle-support-editing-and-deleting-existing-discount-codes-allow-toggling-active-status-inline",
      "title": "Build a Discounts & Coupons page accessible at `/discounts`. Display all discount codes in a table with columns for: code, description, type (percentage/fixed), value, minimum order, max uses, used count, expiry date, and status badge (active/inactive). Include an 'Add Discount Code' modal with all required fields: code, description, discount type selector (percentage or fixed), discount value, optional minimum order amount, optional max uses, optional expiry date, and active toggle. Support editing and deleting existing discount codes. Allow toggling active status inline.",
      "reqIds": [
        "REQ-47"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-sales-reports-page-accessible-at-sales-reports-at-the-top-show-two-date-range-pickers-one-for-daily-report-single-date-picker-and-one-for-weekly-report-week-start-date-picker-on-selecting-a-date-and-report-type-display-a-report-card-showing-period-label-total-orders-total-revenue-average-order-value-and-a-top-selling-items-table-item-name-quantity-sold-revenue-include-a-download-csv-button-that-exports-the-displayed-report-data-as-a-csv-file-client-side-no-backend-endpoint-needed-construct-csv-from-the-query-result-in-the-browser",
      "title": "Build a Sales Reports page accessible at `/sales-reports`. At the top, show two date-range pickers: one for 'Daily Report' (single date picker) and one for 'Weekly Report' (week start date picker). On selecting a date and report type, display a report card showing: period label, total orders, total revenue, average order value, and a top-selling items table (item name, quantity sold, revenue). Include a 'Download CSV' button that exports the displayed report data as a CSV file client-side (no backend endpoint needed — construct CSV from the query result in the browser).",
      "reqIds": [
        "REQ-48"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-tax-configuration-page-accessible-at-tax-config-display-all-tax-configs-in-a-table-with-columns-for-name-rate-applies-to-and-status-badge-active-inactive-include-an-add-tax-config-modal-with-fields-name-e-g-gst-rate-float-e-g-10-for-10-applies-to-selector-all-menuitems-combos-and-active-toggle-support-editing-and-deleting-existing-tax-configs-allow-toggling-active-status-inline-show-a-live-preview-panel-that-calculates-tax-on-a-sample-subtotal-entered-by-the-user-displaying-each-active-tax-line-and-total-tax-amount",
      "title": "Build a Tax Configuration page accessible at `/tax-config`. Display all tax configs in a table with columns for: name, rate (%), applies to, and status badge (active/inactive). Include an 'Add Tax Config' modal with fields: name (e.g. 'GST'), rate (Float, e.g. 10 for 10%), applies to selector (#all / #menuItems / #combos), and active toggle. Support editing and deleting existing tax configs. Allow toggling active status inline. Show a live preview panel that calculates tax on a sample subtotal entered by the user, displaying each active tax line and total tax amount.",
      "reqIds": [
        "REQ-49"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-new-order-form-on-the-sales-page-sales-frontend-src-pages-salespage-tsx-to-support-discount-code-application-and-show-a-tax-breakdown-before-submission-add-a-promo-code-input-field-with-an-apply-button-that-calls-useapplydiscountcode-on-success-show-the-discount-amount-deducted-below-the-subtotal-display-a-tax-breakdown-section-listing-each-active-tax-line-name-rate-amount-from-usecalculatetax-applied-to-the-post-discount-subtotal-update-the-order-total-display-to-show-subtotal-discount-if-applied-tax-lines-and-grand-total-pass-the-discountcodeid-if-applied-when-calling-createsaleorder-in-the-sales-history-table-update-the-order-detail-expansion-to-show-discount-amount-tax-breakdown-and-the-final-total",
      "title": "Update the New Order form on the Sales page (`/sales`, `frontend/src/pages/SalesPage.tsx`) to support discount code application and show a tax breakdown before submission. Add a 'Promo Code' input field with an 'Apply' button that calls `useApplyDiscountCode`; on success show the discount amount deducted. Below the subtotal, display a tax breakdown section listing each active tax line (name, rate, amount) from `useCalculateTax` applied to the post-discount subtotal. Update the order total display to show: Subtotal, Discount (if applied), Tax lines, and Grand Total. Pass the discountCodeId (if applied) when calling createSaleOrder. In the Sales History table, update the order detail expansion to show discount amount, tax breakdown, and the final total.",
      "reqIds": [
        "REQ-50"
      ],
      "version": 1
    },
    {
      "id": "feature-verify-and-fix-the-react-query-hooks-in-frontend-src-hooks-usequeries-ts-for-all-discount-tax-and-sales-report-operations-usediscountcodes-usediscountcode-usecreatediscountcode-useupdatediscountcode-usedeletediscountcode-usetogglediscountcodeactive-useapplydiscountcode-usetaxconfigs-usetaxconfig-usecreatetaxconfig-useupdatetaxconfig-usedeletetaxconfig-usetoggletaxconfigactive-usecalculatetax-and-usesalesreport-ensure-each-hook-correctly-calls-the-corresponding-actor-method-uses-the-right-query-keys-and-mutations-invalidate-relevant-queries-on-success",
      "title": "Verify and fix the React Query hooks in `frontend/src/hooks/useQueries.ts` for all discount, tax, and sales report operations: `useDiscountCodes`, `useDiscountCode`, `useCreateDiscountCode`, `useUpdateDiscountCode`, `useDeleteDiscountCode`, `useToggleDiscountCodeActive`, `useApplyDiscountCode`, `useTaxConfigs`, `useTaxConfig`, `useCreateTaxConfig`, `useUpdateTaxConfig`, `useDeleteTaxConfig`, `useToggleTaxConfigActive`, `useCalculateTax`, and `useSalesReport`. Ensure each hook correctly calls the corresponding actor method, uses the right query keys, and mutations invalidate relevant queries on success.",
      "reqIds": [
        "REQ-56"
      ],
      "version": 1
    },
    {
      "id": "feature-verify-and-fix-the-salesreportspage-tsx-page-at-sales-reports-to-correctly-call-usesalesreport-with-the-selected-period-daily-or-weekly-and-referencedate-as-a-unix-timestamp-int-ensure-the-report-card-renders-period-label-total-orders-total-revenue-average-order-value-and-the-top-selling-items-table-ensure-the-csv-export-constructs-the-csv-client-side-from-the-query-result-and-triggers-a-download",
      "title": "Verify and fix the `SalesReportsPage.tsx` page at `/sales-reports` to correctly call `useSalesReport` with the selected period (#daily or #weekly) and referenceDate (as a Unix timestamp Int). Ensure the report card renders: period label, total orders, total revenue, average order value, and the top-selling items table. Ensure the CSV export constructs the CSV client-side from the query result and triggers a download.",
      "reqIds": [
        "REQ-59"
      ],
      "version": 1
    },
    {
      "id": "feature-verify-and-fix-the-salespage-tsx-promo-code-and-tax-breakdown-wiring-ensure-the-apply-button-correctly-calls-useapplydiscountcode-with-the-entered-code-and-current-subtotal-displays-the-returned-discount-amount-and-stores-the-discountcodeid-ensure-usecalculatetax-is-called-with-the-post-discount-subtotal-and-each-returned-tax-line-is-displayed-ensure-usecreatesaleorder-is-called-with-the-discountcodeid-if-applied-ensure-the-sales-history-order-detail-expansion-shows-discountamount-taxbreakdown-lines-and-the-final-total",
      "title": "Verify and fix the `SalesPage.tsx` promo code and tax breakdown wiring. Ensure the 'Apply' button correctly calls `useApplyDiscountCode` with the entered code and current subtotal, displays the returned discount amount, and stores the discountCodeId. Ensure `useCalculateTax` is called with the post-discount subtotal and each returned tax line is displayed. Ensure `useCreateSaleOrder` is called with the discountCodeId (if applied). Ensure the Sales History order detail expansion shows discountAmount, taxBreakdown lines, and the final total.",
      "reqIds": [
        "REQ-60"
      ],
      "version": 1
    },
    {
      "id": "feature-add-react-query-hooks-in-frontend-src-hooks-usequeries-ts-for-all-new-backend-operations-introduced-in-req-61-through-req-63-useloyaltybalance-query-by-customerid-useloyaltytransactions-query-by-customerid-useredeemloyaltypoints-mutation-takes-customerid-points-discountamount-useupcomingdeliveries-query-takes-optional-customerid-and-daysahead-usecustomerorderhistory-query-by-customerid-follow-the-same-patterns-as-existing-hooks-actor-based-calls-proper-query-keys-cache-invalidation-on-mutations-useredeemloyaltypoints-should-invalidate-loyaltybalance-customerid-loyaltytransactions-customerid-and-customers-on-success",
      "title": "Add React Query hooks in `frontend/src/hooks/useQueries.ts` for all new backend operations introduced in REQ-61 through REQ-63: `useLoyaltyBalance` (query by customerId), `useLoyaltyTransactions` (query by customerId), `useRedeemLoyaltyPoints` (mutation — takes customerId, points, discountAmount), `useUpcomingDeliveries` (query — takes optional customerId and daysAhead), `useCustomerOrderHistory` (query by customerId). Follow the same patterns as existing hooks (actor-based calls, proper query keys, cache invalidation on mutations). `useRedeemLoyaltyPoints` should invalidate `['loyaltyBalance', customerId]`, `['loyaltyTransactions', customerId]`, and `['customers']` on success.",
      "reqIds": [
        "REQ-65"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-the-customer-detail-view-frontend-src-components-customerdetailview-tsx-to-include-a-order-history-tab-or-section-showing-the-customer-s-full-purchase-timeline-sourced-from-usecustomerorderhistory-display-each-order-in-a-timeline-table-with-columns-order-id-date-time-items-summary-subtotal-discount-tax-and-total-amount-each-row-should-be-expandable-to-show-full-order-details-all-items-with-quantities-and-unit-prices-discount-code-if-applied-tax-breakdown-lines-also-add-a-loyalty-points-section-showing-the-current-points-balance-from-useloyaltybalance-and-a-transaction-history-list-from-useloyaltytransactions-with-columns-date-reason-and-points-colour-coded-green-for-earned-red-for-redeemed-include-a-redeem-points-button-that-opens-a-small-dialog-accepting-a-points-amount-and-discount-value-then-calls-useredeemloyaltypoints",
      "title": "Extend the Customer Detail view (`frontend/src/components/CustomerDetailView.tsx`) to include a 'Order History' tab or section showing the customer's full purchase timeline sourced from `useCustomerOrderHistory`. Display each order in a timeline/table with columns: Order ID, Date/Time, Items Summary, Subtotal, Discount, Tax, and Total Amount. Each row should be expandable to show full order details (all items with quantities and unit prices, discount code if applied, tax breakdown lines). Also add a 'Loyalty Points' section showing the current points balance (from `useLoyaltyBalance`) and a transaction history list (from `useLoyaltyTransactions`) with columns: Date, Reason, and Points (colour-coded green for earned, red for redeemed). Include a 'Redeem Points' button that opens a small dialog accepting a points amount and discount value, then calls `useRedeemLoyaltyPoints`.",
      "reqIds": [
        "REQ-66"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-subscription-delivery-calendar-page-accessible-at-delivery-calendar-display-a-monthly-calendar-view-or-week-view-toggle-showing-upcoming-deliveries-for-all-customers-each-day-cell-should-list-the-customer-name-s-and-plan-name-s-with-deliveries-due-on-that-date-sourced-from-useupcomingdeliveries-with-a-60-day-lookahead-clicking-a-delivery-entry-should-show-a-popover-tooltip-with-full-details-customer-name-plan-name-menu-items-names-and-frequency-include-a-customer-filter-dropdown-at-the-top-to-narrow-the-calendar-to-a-specific-customer-s-deliveries-add-a-delivery-calendar-navigation-link-in-the-layout-sidebar-under-the-subscriptions-section",
      "title": "Build a Subscription Delivery Calendar page accessible at `/delivery-calendar`. Display a monthly calendar view (or week view toggle) showing upcoming deliveries for all customers. Each day cell should list the customer name(s) and plan name(s) with deliveries due on that date, sourced from `useUpcomingDeliveries` with a 60-day lookahead. Clicking a delivery entry should show a popover/tooltip with full details: customer name, plan name, menu items (names), and frequency. Include a customer filter dropdown at the top to narrow the calendar to a specific customer's deliveries. Add a 'Delivery Calendar' navigation link in the Layout sidebar under the Subscriptions section.",
      "reqIds": [
        "REQ-67"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-new-order-form-on-the-sales-page-frontend-src-pages-salespage-tsx-to-include-an-optional-customer-selector-dropdown-populated-from-usecustomers-so-that-a-sale-order-can-be-attributed-to-a-specific-customer-when-a-customer-is-selected-display-their-current-loyalty-points-balance-from-useloyaltybalance-pass-the-selected-customerid-when-calling-usecreatesaleorder-after-a-successful-order-submission-display-a-toast-confirming-how-many-loyalty-points-were-awarded-calculated-as-the-integer-part-of-the-order-s-totalamount",
      "title": "Update the New Order form on the Sales page (`frontend/src/pages/SalesPage.tsx`) to include an optional Customer selector dropdown (populated from `useCustomers`) so that a sale order can be attributed to a specific customer. When a customer is selected, display their current loyalty points balance (from `useLoyaltyBalance`). Pass the selected customerId when calling `useCreateSaleOrder`. After a successful order submission, display a toast confirming how many loyalty points were awarded (calculated as the integer part of the order's totalAmount).",
      "reqIds": [
        "REQ-68"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-admin-settings-page-frontend-src-pages-adminsettingspage-tsx-so-that-when-the-current-user-does-not-have-admin-access-and-the-admin-role-is-vacant-i-e-getadminprincipal-returns-an-empty-null-principal-or-claimadminifvacant-would-succeed-the-page-displays-a-claim-admin-button-that-calls-useclaimadminifvacant-currently-the-page-only-shows-you-do-not-have-admin-access-without-offering-the-claim-option-the-logic-should-be-1-if-the-user-is-the-admin-show-the-full-admin-panel-reassign-vacate-2-if-the-user-is-not-the-admin-but-the-admin-role-is-vacant-show-the-claim-admin-if-vacant-button-with-explanatory-text-3-if-the-user-is-not-the-admin-and-an-admin-is-already-assigned-show-the-you-do-not-have-admin-access-message-only-show-success-or-error-feedback-after-the-claim-attempt",
      "title": "Fix the Admin Settings page (`frontend/src/pages/AdminSettingsPage.tsx`) so that when the current user does not have admin access AND the admin role is vacant (i.e., `getAdminPrincipal` returns an empty/null principal or `claimAdminIfVacant` would succeed), the page displays a 'Claim Admin' button that calls `useClaimAdminIfVacant`. Currently the page only shows 'You do not have admin access' without offering the claim option. The logic should be: (1) if the user IS the admin — show the full admin panel (reassign, vacate); (2) if the user is NOT the admin but the admin role IS vacant — show the 'Claim Admin (if vacant)' button with explanatory text; (3) if the user is NOT the admin and an admin IS already assigned — show the 'You do not have admin access' message only. Show success or error feedback after the claim attempt.",
      "reqIds": [
        "REQ-69"
      ],
      "version": 1
    },
    {
      "id": "feature-add-react-query-hooks-in-frontend-src-hooks-usequeries-ts-for-all-new-backend-staff-account-and-audit-log-operations-usestaffaccounts-query-usestaffaccount-query-by-id-usemyrole-query-usecreatestaffaccount-mutation-useupdatestaffaccount-mutation-usedeletestaffaccount-mutation-useauditlogs-query-takes-limit-and-offset-params-follow-the-same-patterns-as-existing-hooks-actor-based-calls-proper-query-keys-cache-invalidation-on-mutations-mutation-hooks-for-create-update-and-delete-should-invalidate-staffaccounts-on-success",
      "title": "Add React Query hooks in `frontend/src/hooks/useQueries.ts` for all new backend staff account and audit log operations: `useStaffAccounts` (query), `useStaffAccount` (query by id), `useMyRole` (query), `useCreateStaffAccount` (mutation), `useUpdateStaffAccount` (mutation), `useDeleteStaffAccount` (mutation), `useAuditLogs` (query — takes limit and offset params). Follow the same patterns as existing hooks (actor-based calls, proper query keys, cache invalidation on mutations). Mutation hooks for create, update, and delete should invalidate `['staffAccounts']` on success.",
      "reqIds": [
        "REQ-73"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-staff-accounts-management-page-accessible-at-staff-display-all-staff-accounts-in-a-table-with-columns-for-name-principal-truncated-role-badge-cashier-manager-admin-with-distinct-colours-status-active-inactive-badge-and-created-date-include-an-add-staff-account-modal-with-fields-principal-id-text-input-name-text-input-and-role-selector-cashier-manager-admin-support-editing-name-role-isactive-toggle-and-deleting-existing-staff-accounts-with-a-confirmation-dialog-the-page-must-be-restricted-to-admin-users-redirect-non-admins-to-dashboard-add-a-staff-accounts-navigation-link-in-the-layout-sidebar-under-an-admin-section",
      "title": "Build a Staff Accounts management page accessible at `/staff`. Display all staff accounts in a table with columns for: name, principal (truncated), role badge (Cashier/Manager/Admin with distinct colours), status (Active/Inactive badge), and created date. Include an 'Add Staff Account' modal with fields: principal ID (text input), name (text input), and role selector (#cashier, #manager, #admin). Support editing (name, role, isActive toggle) and deleting existing staff accounts with a confirmation dialog. The page must be restricted to admin users (redirect non-admins to dashboard). Add a 'Staff Accounts' navigation link in the Layout sidebar under an 'Admin' section.",
      "reqIds": [
        "REQ-74"
      ],
      "version": 1
    },
    {
      "id": "feature-build-an-activity-log-page-accessible-at-audit-log-display-audit-log-entries-in-a-paginated-table-20-per-page-with-columns-for-timestamp-formatted-date-time-actor-principal-truncated-action-target-type-target-id-if-set-and-details-show-newest-entries-first-include-a-load-more-button-or-simple-pagination-controls-the-page-must-be-restricted-to-admin-users-redirect-non-admins-to-dashboard-add-an-activity-log-navigation-link-in-the-layout-sidebar-under-the-admin-section",
      "title": "Build an Activity Log page accessible at `/audit-log`. Display audit log entries in a paginated table (20 per page) with columns for: timestamp (formatted date/time), actor (principal, truncated), action, target type, target ID (if set), and details. Show newest entries first. Include a 'Load More' button or simple pagination controls. The page must be restricted to admin users (redirect non-admins to dashboard). Add an 'Activity Log' navigation link in the Layout sidebar under the 'Admin' section.",
      "reqIds": [
        "REQ-75"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-a-dark-mode-toggle-in-the-application-add-a-toggle-button-sun-moon-icon-in-the-layout-header-that-switches-between-light-and-dark-themes-persist-the-user-s-preference-in-localstorage-so-it-survives-page-refreshes-the-toggle-must-apply-a-dark-class-to-the-html-element-leveraging-the-existing-dark-mode-css-custom-properties-already-defined-in-frontend-src-index-css-and-frontend-index-css-the-themeprovider-in-frontend-src-app-tsx-should-be-wired-to-honour-the-persisted-preference-on-initial-load",
      "title": "Implement a dark mode toggle in the application. Add a toggle button (sun/moon icon) in the Layout header that switches between light and dark themes. Persist the user's preference in localStorage so it survives page refreshes. The toggle must apply a `dark` class to the `<html>` element, leveraging the existing dark mode CSS custom properties already defined in `frontend/src/index.css` and `frontend/index.css`. The ThemeProvider in `frontend/src/App.tsx` should be wired to honour the persisted preference on initial load.",
      "reqIds": [
        "REQ-76"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-profile-setup-modal-in-frontend-src-components-profilesetupmodal-tsx-so-that-clicking-get-started-after-entering-a-name-does-not-freeze-or-get-stuck-investigate-and-resolve-the-issue-causing-the-modal-to-hang-on-submission-likely-the-createuserprofile-or-equivalent-mutation-call-is-not-resolving-or-the-loading-state-is-never-cleared-ensure-1-the-get-started-button-shows-a-loading-spinner-while-the-mutation-is-in-flight-2-on-success-the-modal-closes-and-the-user-proceeds-normally-3-on-error-a-visible-error-message-is-displayed-and-the-button-becomes-re-clickable-4-the-button-is-disabled-only-while-the-mutation-is-actively-pending-never-indefinitely",
      "title": "Fix the Profile Setup Modal in `frontend/src/components/ProfileSetupModal.tsx` so that clicking 'Get Started' after entering a name does not freeze or get stuck. Investigate and resolve the issue causing the modal to hang on submission — likely the `createUserProfile` (or equivalent) mutation call is not resolving or the loading state is never cleared. Ensure: (1) the 'Get Started' button shows a loading spinner while the mutation is in-flight; (2) on success the modal closes and the user proceeds normally; (3) on error a visible error message is displayed and the button becomes re-clickable; (4) the button is disabled only while the mutation is actively pending, never indefinitely.",
      "reqIds": [
        "REQ-86"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-7",
      "summary": "Menu management: create and manage salad menu items with name, ingredients, pricing, and availability",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Billing & Sales: create sales/orders, generate bills, track revenue and sales history",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Extend the backend actor to support Menu Item management. Add a data type for MenuItem with fields: id (Nat), name (Text), description (Text), ingredients (array of { ingredientId: Nat, quantity: Float }), sellingPrice (Float), isAvailable (Bool), and createdAt (Int). Implement CRUD operations: createMenuItem, getMenuItems, getMenuItem, updateMenuItem, deleteMenuItem, and toggleMenuItemAvailability. All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-7"
      ],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Extend the backend actor to support Sales and Billing. Add a SaleOrder type with fields: id (Nat), items (array of { menuItemId: Nat, menuItemName: Text, quantity: Nat, unitPrice: Float }), subtotal (Float), totalAmount (Float), note (Text), createdAt (Int). Implement: createSaleOrder (records a sale, deducts ingredient quantities from inventory proportionally), getSaleOrders (returns all sales with pagination), getSaleOrder (by ID), and getDashboardSalesStats (total revenue, total orders count, today's revenue, today's orders count).",
      "reqIds": [
        "REQ-8"
      ],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Subscriptions: allow customers to subscribe to meal plans or recurring salad orders",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Customers: manage customer profiles, contact info, and order history",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Alerts: notification system for low stock, subscription renewals, and other important events",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Extend the backend actor to support Customer management. Add a Customer type with fields: id (Nat), name (Text), email (Text), phone (Text), address (Text), notes (Text), createdAt (Int). Implement CRUD operations: createCustomer, getCustomers (with pagination), getCustomer (by ID), updateCustomer, deleteCustomer. All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-13"
      ],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Extend the backend actor to support Subscription management. Add a Subscription type with fields: id (Nat), customerId (Nat), planName (Text), menuItemIds (array of Nat), frequencyDays (Nat), startDate (Int), nextRenewalDate (Int), status (variant: #active, #paused, #cancelled), totalPrice (Float), createdAt (Int). Implement: createSubscription, getSubscriptions (all, with optional filter by customerId), getSubscription (by ID), updateSubscription, cancelSubscription, pauseSubscription, resumeSubscription. All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-14"
      ],
      "status": "pending"
    },
    {
      "id": "AR-16",
      "summary": "Extend the backend actor to support an Alerts system. Add an Alert type with fields: id (Nat), alertType (variant: #lowStock, #subscriptionRenewal, #other), message (Text), relatedEntityId (Nat), isRead (Bool), createdAt (Int). Implement: getAlerts (returns all unread alerts, newest first), markAlertRead (by ID), markAllAlertsRead, and a private helper generateAlerts that creates low-stock alerts for ingredients at or below their threshold and subscription renewal alerts for subscriptions whose nextRenewalDate is within the next 3 days. Call generateAlerts from within getAlerts so alerts are always fresh.",
      "reqIds": [
        "REQ-15"
      ],
      "status": "pending"
    },
    {
      "id": "AR-21",
      "summary": "Generate a migration.mo file that carries over all existing state (userProfiles, inventory, menuItems, salesOrders) from the current actor and initializes empty maps/arrays for the new customers, subscriptions, and alerts collections.",
      "reqIds": [
        "REQ-20"
      ],
      "status": "pending"
    },
    {
      "id": "AR-22",
      "summary": "Supplier management — track supplier contacts, lead times, and auto-generate purchase orders when stock is low",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-23",
      "summary": "Ingredient expiry tracking — add expiry dates to ingredients and get alerts before items expire",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-24",
      "summary": "Waste/spoilage logging — record and analyze food waste to reduce costs",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-25",
      "summary": "Extend the backend actor to support Supplier management. Add a Supplier type with fields: id (Nat), name (Text), contactPerson (Text), email (Text), phone (Text), address (Text), leadTimeDays (Nat), notes (Text), createdAt (Int). Implement CRUD operations: createSupplier, getSuppliers, getSupplier (by ID), updateSupplier, deleteSupplier. All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-21"
      ],
      "status": "pending"
    },
    {
      "id": "AR-26",
      "summary": "Extend the backend actor to support Purchase Orders. Add a PurchaseOrder type with fields: id (Nat), supplierId (Nat), supplierName (Text), items (array of { ingredientId: Nat, ingredientName: Text, quantityOrdered: Float, unit: Text }), status (variant: #pending, #received, #cancelled), notes (Text), createdAt (Int). Implement: createPurchaseOrder, getPurchaseOrders, getPurchaseOrder (by ID), updatePurchaseOrderStatus, and autoGeneratePurchaseOrders (creates pending purchase orders for all ingredients at or below their low-stock threshold, grouped by supplier if the ingredient has a supplierId set). All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-22"
      ],
      "status": "pending"
    },
    {
      "id": "AR-27",
      "summary": "Extend the existing Ingredient type in the backend actor to include two new optional fields: supplierId (optional Nat, linking to a Supplier record) and expiryDate (optional Int, Unix timestamp). Update createIngredient and updateIngredient to accept and persist these fields. Extend getAlerts / generateAlerts to produce #expiryWarning alerts for ingredients whose expiryDate is within the next 7 days.",
      "reqIds": [
        "REQ-23"
      ],
      "status": "pending"
    },
    {
      "id": "AR-28",
      "summary": "Extend the backend actor to support Waste/Spoilage logging. Add a WasteLog type with fields: id (Nat), ingredientId (Nat), ingredientName (Text), quantity (Float), unit (Text), reason (Text — e.g. 'spoiled', 'overcooked', 'dropped'), costLoss (Float — quantity × costPrice at time of logging), loggedAt (Int). Implement: createWasteLog (deducts the wasted quantity from the ingredient's current stock), getWasteLogs (returns all logs, newest first, with optional filter by ingredientId), getWasteStats (returns total waste cost, total waste count, and a breakdown by ingredient). All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-24"
      ],
      "status": "pending"
    },
    {
      "id": "AR-29",
      "summary": "Generate an updated migration.mo file that carries over all existing state (userProfiles, inventory, menuItems, salesOrders, customers, subscriptions, alerts and their ID counters) and initialises empty collections for the new suppliers, purchaseOrders, and wasteLogs maps along with their respective ID counters.",
      "reqIds": [
        "REQ-25"
      ],
      "status": "pending"
    },
    {
      "id": "AR-30",
      "summary": "Recipe costing calculator — automatically show cost per serving vs. selling price (profit margin) on menu items",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-31",
      "summary": "Seasonal or time-based availability — mark menu items available only during specific hours or days",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-32",
      "summary": "Combo/bundle deals — group menu items at a special bundled price",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-33",
      "summary": "Extend the backend actor to support recipe costing on menu items. Add a computed field `costPerServing` (Float) derived by summing each ingredient's costPrice × quantity for all ingredients linked to a menu item. Expose this via `getMenuItem` and `getMenuItems` responses. Add a `getProfitMargin` query that returns, for a given menuItemId, the costPerServing, sellingPrice, gross profit (sellingPrice − costPerServing), and profit margin percentage ((sellingPrice − costPerServing) / sellingPrice × 100). All values must recalculate dynamically based on current ingredient costPrices.",
      "reqIds": [
        "REQ-32"
      ],
      "status": "pending"
    },
    {
      "id": "AR-34",
      "summary": "Extend the backend actor to support time-based availability on menu items. Add optional fields to MenuItem: `availableFromHour` (optional Nat, 0–23), `availableToHour` (optional Nat, 0–23), `availableDays` (optional array of Nat, 0=Sunday … 6=Saturday). Update `createMenuItem` and `updateMenuItem` to accept and persist these fields. Add a query `getAvailableMenuItems` that returns only items where `isAvailable` is true AND the current UTC time falls within the configured hour range and day constraints (if set). All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-33"
      ],
      "status": "pending"
    },
    {
      "id": "AR-35",
      "summary": "Extend the backend actor to support Combo/Bundle deals. Add a new data type `ComboDeal` with fields: id (Nat), name (Text), description (Text), menuItemIds (array of Nat), bundlePrice (Float), isAvailable (Bool), createdAt (Int). Implement CRUD operations: `createComboDeal`, `getCombos`, `getCombo` (by ID), `updateComboDeal`, `deleteComboDeal`, and `toggleComboDealAvailability`. Each combo should also expose a `totalIndividualPrice` (sum of sellingPrice of all linked menu items) and `savings` (totalIndividualPrice − bundlePrice) in read responses. All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-34"
      ],
      "status": "pending"
    },
    {
      "id": "AR-36",
      "summary": "Generate an updated migration.mo file that carries over all existing state (userProfiles, ingredients, menuItems, salesOrders, customers, subscriptions, alerts, suppliers, purchaseOrders, wasteLogs, and all their ID counters) and initialises empty collections for the new comboDeal map and its ID counter, while also migrating existing MenuItem records to include the new optional time-availability fields (availableFromHour, availableToHour, availableDays) as null/absent.",
      "reqIds": [
        "REQ-35"
      ],
      "status": "pending"
    },
    {
      "id": "AR-37",
      "summary": "Add admin role reset/reassign functionality — allow reassigning the admin principal or adding a fallback mechanism to recover admin access",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-38",
      "summary": "Extend the backend actor to support admin role reassignment. Add a public query `getAdminPrincipal` that returns the current admin's principal as Text. Add an update function `reassignAdmin(newPrincipal: Principal)` that can only be called by the current admin, replacing the stored admin principal with the provided one. Add an update function `claimAdminIfVacant()` that allows any authenticated caller to claim the admin role only if no admin is currently set (i.e., the admin slot is empty or has been explicitly vacated). Add an update function `vacateAdmin()` callable only by the current admin to clear the admin principal, enabling a subsequent `claimAdminIfVacant` call. All changes must be persisted in stable state and respect the existing MixinAuthorization role-based access control pattern.",
      "reqIds": [
        "REQ-40"
      ],
      "status": "pending"
    },
    {
      "id": "AR-39",
      "summary": "Discount & coupon system — create promo codes or percentage/fixed discounts for orders, grouped under Sales tab dropdown",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-40",
      "summary": "Daily/weekly sales reports — downloadable summaries of revenue and top-selling items, grouped under Sales tab dropdown",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-41",
      "summary": "Tax configuration — add GST/VAT settings and show tax breakdowns on bills, grouped under Sales tab dropdown",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-42",
      "summary": "Reorganize Sales navigation as a dropdown in the sidebar/header containing: Sales (existing), Discounts & Coupons, Sales Reports, and Tax Configuration sub-links",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-43",
      "summary": "Extend the backend actor to support a Discount & Coupon system. Add a `DiscountCode` type with fields: id (Nat), code (Text, unique), description (Text), discountType (variant: #percentage | #fixed), discountValue (Float), minimumOrderAmount (Float), maxUses (optional Nat), usedCount (Nat), isActive (Bool), expiresAt (optional Int Unix timestamp), createdAt (Int). Implement: `createDiscountCode`, `getDiscountCodes` (returns all), `getDiscountCode` (by ID), `updateDiscountCode`, `deleteDiscountCode`, `toggleDiscountCodeActive`, and `applyDiscountCode(code: Text, orderSubtotal: Float)` — which validates the code (active, not expired, not exceeded max uses), increments usedCount, and returns the discount amount and final discounted total. All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-42"
      ],
      "status": "pending"
    },
    {
      "id": "AR-44",
      "summary": "Extend the backend actor to support Tax Configuration. Add a `TaxConfig` type with fields: id (Nat), name (Text — e.g. 'GST', 'VAT'), rate (Float — percentage, e.g. 10.0 for 10%), isActive (Bool), appliesTo (variant: #all | #menuItems | #combos), createdAt (Int). Implement: `createTaxConfig`, `getTaxConfigs` (returns all), `getTaxConfig` (by ID), `updateTaxConfig`, `deleteTaxConfig`, `toggleTaxConfigActive`. Also add a `calculateTax(subtotal: Float)` query that returns an array of applied taxes (name, rate, amount) and total tax amount based on all active tax configs. All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-43"
      ],
      "status": "pending"
    },
    {
      "id": "AR-45",
      "summary": "Extend the backend actor to support Sales Reports. Add a `getSalesReport(period: variant { #daily | #weekly }, referenceDate: Int })` query that returns: period label (e.g. '2024-06-10' or 'Week of 2024-06-10'), total orders count, total revenue, top-selling menu items (array of { menuItemId: Nat, menuItemName: Text, quantitySold: Nat, revenue: Float } sorted by quantitySold descending, top 10), and average order value. The report is computed dynamically from existing salesOrders data filtered to the requested period (UTC). This is a query — no write restrictions needed.",
      "reqIds": [
        "REQ-44"
      ],
      "status": "pending"
    },
    {
      "id": "AR-46",
      "summary": "Update the `createSaleOrder` backend function to accept two new optional parameters: `discountCodeId` (optional Nat) and apply active taxes automatically. When a discountCodeId is provided, call the discount validation logic and apply the discount to the subtotal. Then apply all active tax configs via calculateTax to the post-discount subtotal. Persist in SaleOrder: `discountCodeId` (optional Nat), `discountAmount` (Float), `taxBreakdown` (array of { name: Text, rate: Float, amount: Float }), `taxTotal` (Float), and update `totalAmount` to equal subtotal − discountAmount + taxTotal. Generate an updated migration.mo that carries over all prior state and initialises empty collections for discountCodes and taxConfigs with their ID counters.",
      "reqIds": [
        "REQ-45"
      ],
      "status": "pending"
    },
    {
      "id": "AR-52",
      "summary": "Reorganize the Sales section in the Layout navigation (`frontend/src/components/Layout.tsx`) as a collapsible dropdown group in the sidebar/header. The dropdown label is 'Sales' with a chevron icon. It contains four sub-links: 'Sales' (→ /sales, existing), 'Discounts & Coupons' (→ /discounts), 'Sales Reports' (→ /sales-reports), and 'Tax Configuration' (→ /tax-config). The dropdown should expand automatically when the current route matches any of the four sub-paths. Register the three new routes (/discounts, /sales-reports, /tax-config) in `frontend/src/App.tsx` pointing to their respective new page components.",
      "reqIds": [
        "REQ-51"
      ],
      "status": "pending"
    },
    {
      "id": "AR-53",
      "summary": "Ensure the backend actor fully implements the Discount & Coupon system as specified: `createDiscountCode`, `getDiscountCodes`, `getDiscountCode` (by ID), `updateDiscountCode`, `deleteDiscountCode`, `toggleDiscountCodeActive`, and `applyDiscountCode(code: Text, orderSubtotal: Float)` — which validates the code (active, not expired, not exceeded max uses), increments usedCount, and returns the discount amount and final discounted total. All write operations must be restricted to admin role. Verify that stable state for discountCodes and its ID counter is declared and persisted correctly.",
      "reqIds": [
        "REQ-52"
      ],
      "status": "pending"
    },
    {
      "id": "AR-54",
      "summary": "Ensure the backend actor fully implements Tax Configuration: `createTaxConfig`, `getTaxConfigs`, `getTaxConfig` (by ID), `updateTaxConfig`, `deleteTaxConfig`, `toggleTaxConfigActive`, and `calculateTax(subtotal: Float)` — which returns an array of applied taxes (name, rate, amount) and total tax amount based on all active tax configs. All write operations must be restricted to admin role. Verify that stable state for taxConfigs and its ID counter is declared and persisted correctly.",
      "reqIds": [
        "REQ-53"
      ],
      "status": "pending"
    },
    {
      "id": "AR-55",
      "summary": "Ensure the backend actor fully implements the `getSalesReport(period: variant { #daily | #weekly }, referenceDate: Int)` query. It must return: a period label (e.g. '2024-06-10' or 'Week of 2024-06-10'), total orders count, total revenue, average order value, and a top-selling items array (menuItemId, menuItemName, quantitySold, revenue) sorted by quantitySold descending, limited to top 10. The report must be computed from existing salesOrders filtered by UTC date range matching the requested period.",
      "reqIds": [
        "REQ-54"
      ],
      "status": "pending"
    },
    {
      "id": "AR-56",
      "summary": "Ensure the `createSaleOrder` backend function correctly accepts the optional `discountCodeId` parameter, applies discount logic via the discount validation path, then applies all active tax configs via `calculateTax` to the post-discount subtotal. Persist on the SaleOrder record: `discountCodeId` (optional Nat), `discountAmount` (Float), `taxBreakdown` (array of { name: Text, rate: Float, amount: Float }), `taxTotal` (Float), and set `totalAmount` = subtotal − discountAmount + taxTotal. Ensure stable state migration carries all prior collections and initialises discountCodes and taxConfigs with their ID counters.",
      "reqIds": [
        "REQ-55"
      ],
      "status": "pending"
    },
    {
      "id": "AR-58",
      "summary": "Verify and fix the `DiscountsPage.tsx` page at `/discounts` to correctly use the discount React Query hooks. Ensure the Add/Edit modal submits valid payloads to `useCreateDiscountCode` and `useUpdateDiscountCode`, the delete confirmation calls `useDeleteDiscountCode`, the inline toggle calls `useToggleDiscountCodeActive`, and all table columns (code, description, type, value, minimum order, max uses, used count, expiry date, status badge) display correctly from the fetched data.",
      "reqIds": [
        "REQ-57"
      ],
      "status": "pending"
    },
    {
      "id": "AR-59",
      "summary": "Verify and fix the `TaxConfigPage.tsx` page at `/tax-config` to correctly use the tax React Query hooks. Ensure the Add/Edit modal submits to `useCreateTaxConfig` / `useUpdateTaxConfig`, the delete confirmation calls `useDeleteTaxConfig`, the inline toggle calls `useToggleTaxConfigActive`, and the live preview panel calls `useCalculateTax` with the user-entered subtotal and displays each active tax line and total tax amount.",
      "reqIds": [
        "REQ-58"
      ],
      "status": "pending"
    },
    {
      "id": "AR-60",
      "summary": "Customer loyalty points — earn points per order, redeem for discounts",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-61",
      "summary": "Subscription delivery calendar — visual schedule showing upcoming deliveries per customer",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-62",
      "summary": "Customer order history — full purchase timeline visible on each customer profile",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-63",
      "summary": "Extend the backend actor to support a Customer Loyalty Points system. Add a `loyaltyPoints` field (Nat, default 0) to the existing Customer type. Add a `LoyaltyTransaction` type with fields: id (Nat), customerId (Nat), points (Int — positive for earned, negative for redeemed), reason (Text), createdAt (Int). Implement: `getLoyaltyBalance(customerId: Nat)` returning current points balance; `getLoyaltyTransactions(customerId: Nat)` returning all transactions for a customer newest-first; `redeemLoyaltyPoints(customerId: Nat, points: Nat, discountAmount: Float)` which deducts the given points from the customer's balance and records a redemption transaction (fails if insufficient balance); and a private helper `awardLoyaltyPoints(customerId: Nat, points: Nat, reason: Text)` that adds points and records an earn transaction. Call `awardLoyaltyPoints` from within `createSaleOrder` — award 1 point per whole unit of currency spent on the order's totalAmount (i.e. `Float.toInt(totalAmount)` points), linking via the order's customerId if provided. Add an optional `customerId` field (optional Nat) to `SaleOrder` so orders can be attributed to customers. All write operations must be restricted to admin role.",
      "reqIds": [
        "REQ-61"
      ],
      "status": "pending"
    },
    {
      "id": "AR-64",
      "summary": "Extend the backend actor to support a Subscription Delivery Calendar. Add a `getUpcomingDeliveries(customerId: optional Nat, daysAhead: Nat)` query that returns all active subscriptions (optionally filtered by customerId) whose `nextRenewalDate` falls within the next `daysAhead` days from now. Each result entry should include: subscriptionId (Nat), customerId (Nat), customerName (Text), planName (Text), menuItemIds (array of Nat), nextRenewalDate (Int — Unix timestamp), and frequencyDays (Nat). Results should be sorted by nextRenewalDate ascending.",
      "reqIds": [
        "REQ-62"
      ],
      "status": "pending"
    },
    {
      "id": "AR-65",
      "summary": "Extend the backend actor to support Customer Order History. Add a `getCustomerOrderHistory(customerId: Nat)` query that returns all SaleOrders where the order's `customerId` field matches the given customerId, sorted by createdAt descending. Each entry should include all existing SaleOrder fields (id, items, subtotal, totalAmount, discountAmount, taxBreakdown, taxTotal, note, createdAt) plus the discountCodeId if set. Also update `createSaleOrder` to accept and persist the optional `customerId` field (if not already done in REQ-61).",
      "reqIds": [
        "REQ-63"
      ],
      "status": "pending"
    },
    {
      "id": "AR-66",
      "summary": "Generate an updated `migration.mo` file that carries over all existing stable state (userProfiles, ingredients, menuItems, salesOrders, customers, subscriptions, alerts, suppliers, purchaseOrders, wasteLogs, comboDeal, discountCodes, taxConfigs, and all their ID counters) and initialises empty collections for the new loyaltyTransactions map and its ID counter. Migrate existing Customer records to include a `loyaltyPoints` field defaulting to 0. Migrate existing SaleOrder records to include `customerId` as null/absent.",
      "reqIds": [
        "REQ-64"
      ],
      "status": "pending"
    },
    {
      "id": "AR-67",
      "summary": "Role-based staff accounts — separate access levels for cashier, manager, and admin roles",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-68",
      "summary": "Activity/audit log — track who made changes and when across the app",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-69",
      "summary": "Dark mode toggle — allow users to switch between light and dark UI themes",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-70",
      "summary": "Extend the backend actor to support role-based staff accounts. Add a `StaffRole` variant type with values: `#cashier`, `#manager`, `#admin`. Add a `StaffAccount` type with fields: id (Nat), principal (Principal), name (Text), role (StaffRole), isActive (Bool), createdAt (Int). Implement: `createStaffAccount(principal: Principal, name: Text, role: StaffRole)` (admin only), `getStaffAccounts` (returns all, admin only), `getStaffAccount(id: Nat)` (admin only), `updateStaffAccount(id: Nat, name: Text, role: StaffRole, isActive: Bool)` (admin only), `deleteStaffAccount(id: Nat)` (admin only), and `getMyRole()` (public query — returns the role of the calling principal, or null if not a staff member). The existing admin principal always implicitly has the `#admin` role. All write operations must be restricted to admin role. Persist staffAccounts in stable state.",
      "reqIds": [
        "REQ-70"
      ],
      "status": "pending"
    },
    {
      "id": "AR-71",
      "summary": "Extend the backend actor to support an Activity/Audit Log. Add an `AuditLog` type with fields: id (Nat), actor (Text — principal as Text), action (Text — e.g. 'createMenuItem', 'deleteIngredient'), targetType (Text — e.g. 'MenuItem', 'Ingredient'), targetId (optional Nat), details (Text — human-readable summary of the change), timestamp (Int — Unix timestamp nanoseconds). Implement: `getAuditLogs(limit: Nat, offset: Nat)` (returns paginated logs newest-first, admin only). Add a private helper `logAudit(action: Text, targetType: Text, targetId: ?Nat, details: Text)` that records an entry with the caller's principal. Call `logAudit` from all write operations (create, update, delete, toggle, status change) across all existing domains: ingredients, menu items, sale orders, customers, subscriptions, suppliers, purchase orders, waste logs, combo deals, discount codes, tax configs, staff accounts, and admin role changes. Persist auditLogs in stable state.",
      "reqIds": [
        "REQ-71"
      ],
      "status": "pending"
    },
    {
      "id": "AR-72",
      "summary": "Generate an updated `migration.mo` file that carries over all existing stable state (userProfiles, ingredients, menuItems, salesOrders, customers, subscriptions, alerts, suppliers, purchaseOrders, wasteLogs, comboDeal, discountCodes, taxConfigs, loyaltyTransactions and all their ID counters) and initialises empty collections for the new `staffAccounts` map, `auditLogs` map, and their respective ID counters.",
      "reqIds": [
        "REQ-72"
      ],
      "status": "pending"
    },
    {
      "id": "AR-73",
      "summary": "Verify and fix the backend actor in `backend/main.mo` to fully implement the staff accounts feature. Ensure stable declarations exist for `staffAccounts` (HashMap/map of Nat → StaffAccount) and `staffAccountIdCounter` (Nat). Confirm `createStaffAccount`, `getStaffAccounts`, `getStaffAccount`, `updateStaffAccount`, `deleteStaffAccount`, and `getMyRole` are all present, correctly typed, and that write operations enforce admin-only access. The existing admin principal must implicitly return `#admin` from `getMyRole`. Ensure all write operations call `logAudit`.",
      "reqIds": [
        "REQ-77"
      ],
      "status": "pending"
    },
    {
      "id": "AR-74",
      "summary": "Verify and fix the backend actor in `backend/main.mo` to fully implement the audit log feature. Ensure stable declarations exist for `auditLogs` (map of Nat → AuditLog) and `auditLogIdCounter` (Nat). Confirm the private helper `logAudit(action, targetType, targetId, details)` records the caller's principal and current timestamp. Confirm `getAuditLogs(limit, offset)` returns paginated entries newest-first and is admin-only. Verify that `logAudit` is called from ALL write operations across all domains: ingredients, menu items, sale orders, customers, subscriptions, suppliers, purchase orders, waste logs, combo deals, discount codes, tax configs, staff accounts, and admin role changes.",
      "reqIds": [
        "REQ-78"
      ],
      "status": "pending"
    },
    {
      "id": "AR-75",
      "summary": "Generate an updated `backend/migration.mo` that carries over all existing stable state (userProfiles, ingredients, menuItems, salesOrders, customers, subscriptions, alerts, suppliers, purchaseOrders, wasteLogs, comboDeal, discountCodes, taxConfigs, loyaltyTransactions and all their ID counters) and initialises empty collections for `staffAccounts`, `auditLogs`, and their respective ID counters (`staffAccountIdCounter`, `auditLogIdCounter`). This migration must be safe to run on a canister that already has the prior state from migration version targeting loyalty transactions.",
      "reqIds": [
        "REQ-79"
      ],
      "status": "pending"
    },
    {
      "id": "AR-76",
      "summary": "Verify and fix the React Query hooks in `frontend/src/hooks/useQueries.ts` for all staff account and audit log operations: `useStaffAccounts`, `useStaffAccount` (by id), `useMyRole`, `useCreateStaffAccount`, `useUpdateStaffAccount`, `useDeleteStaffAccount`, and `useAuditLogs` (takes limit and offset). Ensure each hook calls the correct actor method, uses appropriate query keys, and that mutation hooks for create, update, and delete invalidate `['staffAccounts']` on success. `useAuditLogs` should use query key `['auditLogs', limit, offset]`.",
      "reqIds": [
        "REQ-80"
      ],
      "status": "pending"
    },
    {
      "id": "AR-77",
      "summary": "Verify and fix the Staff Accounts management page at `frontend/src/pages/StaffAccountsPage.tsx`. The page must: fetch staff accounts via `useStaffAccounts`; display them in a table with columns for name, principal (truncated to 12 chars with ellipsis), role badge (Cashier=blue, Manager=orange, Admin=green), status (Active/Inactive badge), and created date (formatted); include an 'Add Staff Account' modal with fields for principal ID, name, and role selector (`#cashier`, `#manager`, `#admin`) that submits via `useCreateStaffAccount`; support editing (name, role, isActive toggle) via `useUpdateStaffAccount`; support deleting with a confirmation dialog via `useDeleteStaffAccount`. The page must redirect non-admin users to `/dashboard` using `useMyRole`. The 'Staff Accounts' link must appear in the Layout sidebar under an 'Admin' section.",
      "reqIds": [
        "REQ-81"
      ],
      "status": "pending"
    },
    {
      "id": "AR-78",
      "summary": "Verify and fix the Activity Log page at `frontend/src/pages/AuditLogPage.tsx`. The page must: fetch audit log entries via `useAuditLogs(limit, offset)` starting with limit=20 and offset=0; display entries in a table with columns for timestamp (formatted date/time), actor (principal truncated to 12 chars), action (with a colour-coded badge), target type, target ID (if set, otherwise '—'), and details; show newest entries first; include a 'Load More' button that increments offset by 20 and appends additional rows; redirect non-admin users to `/dashboard` using `useMyRole`. The 'Activity Log' link must appear in the Layout sidebar under the 'Admin' section.",
      "reqIds": [
        "REQ-82"
      ],
      "status": "pending"
    },
    {
      "id": "AR-79",
      "summary": "Verify and fix the dark mode toggle implementation across the application. Ensure `frontend/src/hooks/useDarkMode.ts` correctly reads the persisted preference from `localStorage` on initialisation and applies/removes the `dark` class on the `<html>` element. Ensure `frontend/src/App.tsx` calls the hook (or a ThemeProvider that uses it) on mount so the correct theme is applied before first render. Ensure the toggle button (sun/moon icon) in `frontend/src/components/Layout.tsx` uses `useDarkMode` and visually reflects the current theme. Verify that toggling persists to `localStorage` and survives a page refresh.",
      "reqIds": [
        "REQ-83"
      ],
      "status": "pending"
    },
    {
      "id": "AR-80",
      "summary": "Add a backend function `resetAdminForTesting()` — or more precisely, update the backend actor's `postUpgrade` or stable initialisation logic so that on the next deployment the stored admin principal is cleared (set to null/vacant), allowing any authenticated user to call `claimAdminIfVacant` and become the first admin. Alternatively, expose a one-time `clearAdminPrincipal()` function that clears the stored admin principal unconditionally (no caller restriction), intended only for recovery. The safest approach is to clear the `adminPrincipal` stable variable in the migration so it initialises as vacant on the next canister upgrade.",
      "reqIds": [
        "REQ-84"
      ],
      "status": "pending"
    },
    {
      "id": "AR-81",
      "summary": "Update `backend/migration.mo` to carry over all existing stable state unchanged AND explicitly reset the `adminPrincipal` field to the vacant/null state during migration, so that after the canister upgrade no admin is assigned and the role is open to be claimed.",
      "reqIds": [
        "REQ-85"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Salad Khatora",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}